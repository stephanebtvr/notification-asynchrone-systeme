<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  </head>
  <body>
    <h1>WebSocket Test - Notifications</h1>
    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
    <h2>Received Notifications:</h2>
    <div
      id="notifications"
      style="
        border: 1px solid #ccc;
        padding: 10px;
        height: 300px;
        overflow-y: auto;
      "
    ></div>

    <script>
      let stompClient = null;

      function connect() {
        const socket = new SockJS("http://localhost:8080/ws");
        stompClient = Stomp.over(socket);

        stompClient.connect(
          {},
          function (frame) {
            console.log("Connected: " + frame);
            document.getElementById("notifications").innerHTML +=
              "<p><strong>‚úÖ Connected to WebSocket!</strong></p>";

            // S'abonner au topic des notifications
            stompClient.subscribe("/topic/notifications", function (message) {
              const notification = JSON.parse(message.body);
              showNotification(notification);
            });
          },
          function (error) {
            console.error("Connection error:", error);
            document.getElementById("notifications").innerHTML +=
              "<p><strong>‚ùå Connection failed!</strong></p>";
          }
        );
      }

      function disconnect() {
        if (stompClient !== null) {
          stompClient.disconnect();
        }
        console.log("Disconnected");
        document.getElementById("notifications").innerHTML +=
          "<p><strong>üîå Disconnected</strong></p>";
      }

      function showNotification(notification) {
        const div = document.getElementById("notifications");
        const timestamp = new Date(notification.timestamp).toLocaleString();

        const colors = {
          INFO: "#3498db",
          SUCCESS: "#2ecc71",
          WARNING: "#f39c12",
          ERROR: "#e74c3c",
        };

        const color = colors[notification.type] || "#95a5a6";

        div.innerHTML += `
                <div style="
                    border-left: 4px solid ${color}; 
                    padding: 10px; 
                    margin: 5px 0; 
                    background-color: #f8f9fa;
                ">
                    <strong style="color: ${color}">[${notification.type}]</strong> 
                    ${notification.title}<br>
                    <small>${notification.message}</small><br>
                    <em style="font-size: 0.8em; color: #6c757d;">${timestamp} | ID: ${notification.id}</em>
                </div>
            `;

        // Scroller vers le bas automatiquement
        div.scrollTop = div.scrollHeight;
      }
    </script>
  </body>
</html>
